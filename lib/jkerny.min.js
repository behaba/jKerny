/*global jQuery */
/*!
 * jKerny.js
 * Version: 1.33
 * Copyright 2011 Olivier Gorzalka
 * CSS Parser adapted from the jQuery based CSS parser by Daniel Wachsstock Copyright (c) 2011
 * MIT license
 */
// jkerny opts
var jk_opts = {
    crossbrowser : true // it makes pseudo-selectors work with old browsers. Great but bad for performance
};
(function(c){function v(a){var a=l[a].replace(/^{|}$/g,""),b={},a=s(a);c.each(a.split(";"),function(a,e){e=e.split(":");2>e.length||(b[k(e[0])]=k(e.slice(1).join(":")))});return b}function s(a,b){for(var a=a.replace(w,"$1").replace(x,function(a,f){if(!f)return"";var b="%s`"+ ++m+"`s%";l[m]=f.replace(/^\\/,"");return b}),d=b?y:z;match=d.exec(a);)replacement="%b`"+ ++m+"`b%",l[m]=match[0],a=a.replace(d,replacement);return a}function k(a){if(void 0===a)return a;for(;match=t.exec(a);)a=a.replace(t,l[match[1]]); return c.trim(a)}function A(a,b){var d=a.split(/\s+/),e=d.shift();"media"==e?(e=k(d.pop()).slice(1,-1),c.parsecss.mediumApplies(d.join(" "))&&c.parsecss(e,b)):"import"==e&&(e=k(d.shift()),c.parsecss.mediumApplies(d.join(" "))&&(e=e.replace(/^url\(|\)$/gi,"").replace(/^["']|["']$/g,""),c.get(e,function(a){c.parsecss(a,b)})))}function o(a,b,d,e){var b=a.text().split(b),f="";b.length&&(c(b).each(function(a,b){f+='<span class="'+d+(a+1)+'">'+b+"</span>"+e}),a.empty().append(f))}c.parsecss=function(a, b){var d={},a=s(a).replace(/@(([^;`]|`[^b]|`b[^%])*(`b%)?);?/g,function(a,f){A(c.trim(f),b);return""});c.each(a.split("`b%"),function(a,b){b=b.split("%b`");2>b.length||(b[0]=k(b[0]),d[b[0]]=c.extend(d[b[0]]||{},v(b[1])))});b(d)};c.parsecss.mediumApplies=window.media&&window.media.query||function(a){if(!a)return!0;if(a in p)return p[a];c('<style media="'+a+'">body {position: relative; z-index: 1;}</style>').appendTo("head");return p[a]=1==c("body").css("z-index")};var p={},l={},z=/{[^{}]*}/,y=/\[[^\[\]]*\]|{[^{}]*}|\([^()]*\)|function(\s+\w+)?(\s*%b`\d+`b%){2}/, w=/\/\*@((?:[^\*]|\*[^\/])*)\*\//g,x=/(?:\/\*(?:[^\*]|\*[^\/])*\*\/)|(\\.|"(?:[^\\\"]|\\.|\\\n)*"|'(?:[^\\\']|\\.|\\\n)*')/g,t=/%\w`(\d+)`\w%/,m=0,q={init:function(){return this.each(function(){o(c(this),"","char","")})},words:function(){return this.each(function(){o(c(this)," ","word"," ")})},lines:function(){return this.each(function(){o(c(this).children("br").replaceWith("eefec303079ad17405c889e092e105b0").end(),"eefec303079ad17405c889e092e105b0","line","")})}};c.fn.lettering=function(a){if(a&& q[a])return q[a].apply(this,[].slice.call(arguments,1));if("letters"===a||!a)return q.init.apply(this,[].slice.call(arguments,0));c.error("Method "+a+" does not exist on jQuery.lettering");return this};c.jkerny_style=function(a,b){options=c.extend({type:"text/css",media:"all",styleClass:"default"},b);var d=document,e=d.createElement("style"),f="",j;for(j in a)if(a[j].hasOwnProperty){var f=f+(j+" {"),i;for(i in a[j])f+=i+":"+a[j][i]+"; ";f+="} "}d.createStyleSheet?d.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd", '&nbsp;<style class="'+options.styleClass+'" media="'+options.media+'" type="text/css">'+f+"</style>"):(e=d.createElement("style"),e.type="text/css",e.media=options.media,e.className=options.styleClass,e.appendChild(d.createTextNode(f)),d.getElementsByTagName("head")[0].appendChild(e))};var u={":unknown":"",":((first|last)(-))?(letter|word)":"._$2$3$4","._(letter|word):(first|last)-child":"._$2-$1","._((last|first)-)letter":"span.jkerny-word:$2-child span.jkerny-letter:$2-child","._((last|first)-)word":"span.jkerny-word:$2-child", "._(letter|word)":"span.jkerny-$1","(span.jkerny-word([^ ]*)?) *span.jkerny-word:(first|last)-child":"$1"},r=/(>|~|\+)? span.jkerny-(letter|word)/gi,g="all",n=0,h={};c.jkerny={run:function(){var a=this;c.jkerny_style({"span.jkerny-word, span.jkerny-letter":{display:"inline-block"},".jkerny":{visibility:"inherit"}},{styleClass:"jkerny"});c("style:not(.jkerny),link[rel=stylesheet]").each(function(){h[g]={};this.href&&!this.disabled&&!(0>this.href.indexOf("//"+window.location.host)&&/^\w+:/.test(this.href))? c.ajax({url:this.href,success:function(b){g="undefined"==typeof c(this).attr("media")?"all":c(this).attr("media");a.parseCss(b)}}):(g="undefined"==typeof c(this).attr("media")?"all":c(this).attr("media"),a.parseCss(c(this).removeAttr("type").html()))})},parseMediaQueries:function(a){if(a=a.match(RegExp(/@media([^\{]+)\{([^\{\}]+\{[^\}\{]+\})+/),"gi"))for(var b=0;b<a.length;b++)g=c.trim(a[1]),"undefined"==typeof h[g]&&(h[g]={}),this.parseCss(a[2],!0)},parseCss:function(a,b){var d=this,e=b||!1,a=d.convertPseudoSelectors(a); c.parsecss(a,function(a){selectors=d.filterSelectors(a);d.proceedCss(selectors)});!1===e&&d.parseMediaQueries(a)},convertPseudoSelectors:function(a){for(var b in u)a=a.replace(RegExp(b,"gi")," "+u[b]);return a},getLength:function(a){var b=0,d;for(d in a)b++;return b},applyProperties:function(a,b){var d,e,f,j,i;j=b.split(",");for(i=0;i<j.length;i++)j[i].replace(RegExp(":(hover|enabled|disabled|focus|checked|target|active|visited|after|before)","gi"),"").split(r),d=c(j[i].replace(RegExp(":(hover|enabled|disabled|focus|checked|target|active|visited|after|before)", "gi"),"")),f=d.is(".jkerny-letter")?"letter":"word",e=j[i].replace(RegExp("span.jkerny-(letter|word)(:(eq|empty|(first|last|only|nth(-last)?)-(child|of-type))([^\\)]*\\))?)?","gi"),".jkerny-$1-"+n),d.addClass("jkerny-"+f+"-"+n).parent(".jkerny-word").addClass("jkerny-word-"+n),h[g][e]=a[b];n++},proceedCss:function(a){var b,d,e;if(0<this.getLength(a))for(var f in a){b=f.split(",");for(e=0;e<b.length;e++)d=c(b[e].replace(RegExp(":(hover|enabled|disabled|focus|checked|target|active|visited|after|before)", "gi"),"").split(r)[0]),d.not(".jkerny").addClass("jkerny").lettering("words").children("span").addClass("jkerny-word").lettering().children("span").addClass("jkerny-letter");jk_opts.crossbrowser?this.applyProperties(a,f):h[g][f]=a[f]}0<this.getLength(h[g])&&(c.jkerny_style(h[g],{media:g,styleClass:"jkerny"}),h[g]={})},filterSelectors:function(a){var b={},d=[],c,f,j,i,g,h;for(h in a){-1<h.indexOf("jkerny-")&&(b[h]=a[h]);for(var k in a[h])if(c=k.match(RegExp(/-jkerny-(letter|word)-spacing/),"gi")){d= a[h][c[0]].replace(/[\n\s]+/g," ").split(" ");f=h.split(",");for(i=0;i<f.length;i++)for(g=0;g<d.length;g++)j=f[i].replace(RegExp(":(hover|enabled|disabled|focus|checked|target|active|visited|after|before)","gi"),"").split(r)[0],b[j+" span.jkerny-"+c[1]+":eq("+g+")"]={"margin-right":d[g]}}}return b}};c(function(){c.jkerny.run()})})(jQuery);