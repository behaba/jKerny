/*!
 * jKerny.js
 * Version: 1.3
 * Copyright 2011 Olivier Gorzalka
 * CSS Parser adapted from the jQuery based CSS parser by Daniel Wachsstock Copyright (c) 2011
 * MIT license
 */
(function($){var w="undefined",p="span.jkerny-word",y="span.jkerny-letter",v=":eq(",a=" ",e="media",l="";function parsedeclarations(n){var i=munged[n].replace(/^{|}$/g,l),t;return i=munge(i),t={},$.each(i.split(";"),function(n,i){i=i.split(":");if(i.length<2)return;t[restore(i[0])]=restore(i.slice(1).join(":"))}),t}function munge(n,t){n=n.replace(REatcomment,"$1").replace(REcomment_string,function(n,t){if(!t)return l;var i="%s`"+ ++uid+"`s%";return munged[uid]=t.replace(/^\\/,l),i});var i=t?REfull:REbraces;while(match=i.exec(n))replacement="%b`"+ ++uid+"`b%",munged[uid]=match[0],n=n.replace(i,replacement);return n}function restore(n){if(n===undefined)return n;while(match=REmunged.exec(n))n=n.replace(REmunged,munged[match[1]]);return $.trim(n)}function processAtRule(n,t){var i=n.split(/\s+/),u=i.shift(),f,r;u==e?(f=restore(i.pop()).slice(1,-1),$.parsecss.mediumApplies(i.join(a))&&$.parsecss(f,t)):(u="import")&&(r=restore(i.shift()),$.parsecss.mediumApplies(i.join(a))&&(r=r.replace(/^url\(|\)$/gi,l).replace(/^["']|["']$/g,l),$.get(r,function(n){$.parsecss(n,t)})))}function styleAttributes(n,t){var r=l,u,i={};n=n.replace(RESGMLcomment,l).replace(REnotATag,"$1"),munge(n).replace(REtag,function(n,t,f){t=t.toLowerCase(),i[t]?++i[t]:i[t]=1;if(u=/\bstyle\s*=\s*(%s`\d+`s%)/i.exec(f)){var e=/\bid\s*=\s*(\S+)/i.exec(f);e=e?"#"+restore(e[1]).replace(/^['"]|['"]$/g,l):t+v+(i[t]-1)+")",r+=[e,"{",restore(u[1]).replace(/^['"]|['"]$/g,l),"}"].join(l)}}),$.parsecss(r,t)}function injector(n,t,i,r){var f=n.text().split(t),u=l;f.length&&($(f).each(function(n,t){u+='<span class="'+i+(n+1)+'">'+t+"</span>"+r}),n.empty().append(u))}var media,munged,methods;$.parsecss=function(n,t){var i={};n=munge(n).replace(/@(([^;`]|`[^b]|`b[^%])*(`b%)?);?/g,function(n,i){return processAtRule($.trim(i),t),l}),$.each(n.split("`b%"),function(n,t){t=t.split("%b`");if(t.length<2)return;t[0]=restore(t[0]),i[t[0]]=$.extend(i[t[0]]||{},parsedeclarations(t[1]))}),t(i)},$.parsecss.mediumApplies=window.media&&window.media.query||function(n){if(!n)return!0;if(n in media)return media[n];var t=$('<style media="'+n+'">body {position: relative; z-index: 1;}</style>').appendTo("head");return media[n]=([$("body").css("z-index")==1,t.remove()])[0]},$.parsecss.isValidSelector=function(n){var t=$("<style>"+n+"{}</style>").appendTo("head")[0];return([t.styleSheet?!/UNKNOWN/i.test(t.styleSheet.cssText):!!t.sheet.cssRules.length,$(t).remove()])[0]},$.parsecss.parseArguments=function(str){var ret,mungedArguments,i,a;if(!str)return[];for(ret=[],mungedArguments=munge(str,!0).split(/\s+/),i=0;i<mungedArguments.length;++i){a=restore(mungedArguments[i]);try{ret.push(eval("("+a+")"))}catch(err){ret.push(a)}}return ret},$.parsecss.styleAttributes=styleAttributes,media={},munged={};var REbraces=/{[^{}]*}/,REfull=/\[[^\[\]]*\]|{[^{}]*}|\([^()]*\)|function(\s+\w+)?(\s*%b`\d+`b%){2}/,REatcomment=/\/\*@((?:[^\*]|\*[^\/])*)\*\//g,REcomment_string=/(?:\/\*(?:[^\*]|\*[^\/])*\*\/)|(\\.|"(?:[^\\\"]|\\.|\\\n)*"|'(?:[^\\\']|\\.|\\\n)*')/g,REmunged=/%\w`(\d+)`\w%/,uid=0;var RESGMLcomment=/<!--([^-]|-[^-])*-->/g,REnotATag=/(>)[^<]*/g,REtag=/<(\w+)([^>]*)>/g;methods={init:function(){return this.each(function(){injector($(this),l,"char",l)})},words:function(){return this.each(function(){injector($(this),a,"word",a)})},lines:function(){return this.each(function(){var n="eefec303079ad17405c889e092e105b0";injector($(this).children("br").replaceWith(n).end(),n,"line",l)})}},$.fn.lettering=function(n){return n&&methods[n]?methods[n].apply(this,[].slice.call(arguments,1)):n==="letters"||!n?methods.init.apply(this,[].slice.call(arguments,0)):($.error("Method "+n+" does not exist on jQuery.lettering"),this)},$.jkerny={lettering_replace:{":word *:first-letter":"span.jkerny-word span.jkerny-letter:first-child",":word *:last-letter":"span.jkerny-word span.jkerny-letter:last-child",":letter":y,":word":p,":first-word":"span.jkerny-word:first-child",":last-word":"span.jkerny-word:last-child",":first-letter":"span.jkerny-word:first-child span.jkerny-letter:first-child",":last-letter":"span.jkerny-word:last-child span.jkerny-letter:last-child"},only_selectors:[/span\.jkerny-(word|letter)/],only_properties:[/-jkerny-(word|letter)-spacing/],pseudo_selectors:/:(hover|active|focus|visited)/,medias_screen:!1,run:function(){var i={},n=this,t=l;$("style:not([rel=jkerny]),link[rel=stylesheet]").each(function(){var t=this;n.medias_screen=typeof $(t).attr(e)==w?!1:$(t).attr(e),t.href?$.ajax({url:t.href,success:function(t){n.parseCss(t)}}):n.parseCss(t.innerHTML)})},parseMediaQueries:function(n){var i=this,t=n.match(/@media[^\{]+\{([^\{\}]+\{[^\}\{]+\})+/gi);for(key in t)datas=t[key].match(new RegExp(/@media([^\{]+)\{([^\{\}]+\{[^\}\{]+\})+/),"gi"),i.medias_screen=$.trim(datas[1]),i.parseCss(datas[2])},parseCss:function(n){var t=this,n=t.convertPseudoSelectors(n);$.parsecss(n,function(n){selectors=t.filterSelectors(n),t.proceedCss(selectors)}),t.parseMediaQueries(n)},convertPseudoSelectors:function(n){var i=this,t;for(t in i.lettering_replace)n=n.replace(new RegExp(t,"g"),a+i.lettering_replace[t]);return n},rawCss:function(n,t){var i=n+" { ";for(attribute in t)i+=attribute+":"+t[attribute]+"; ";return i+="} "},applyCss:function(n,t){if(n.indexOf(":hover")>-1){var i=n.split(":hover"),r=$(i[0]);r.on("mouseenter",function(){$styledElements=$.trim(i[1])!=l?$(this).find($.trim(i[1])):$(this),$styledElements.data({"default-style":$styledElements.attr("style")}).css(t)});r.on("mouseleave",function(){$styledElements=$.trim(i[1])!=l?$(this).find($.trim(i[1])):$(this),$styledElements.attr("style",$styledElements.data("default-style"))})}else $(n).css(t)},getLength:function(n){var t=0,i;for(i in n)t++;return t},proceedCss:function(n){var o="-jkerny-word-spacing",e=" span.jkerny-word",f="-jkerny-letter-spacing",r=this,h="span.jkerny-word, span.jkerny-letter { display:inline-block } .jkerny { visibility: inherit; }",t,s,u,i,c;if(r.getLength(n)>0){for(t in n){s=$(t.replace(this.pseudo_selectors,l).split(/ span.jkerny-(letter|word)/g)[0]),s.not(".jkerny").addClass("jkerny").lettering("words").children("span").addClass("jkerny-word").lettering().children("span").addClass("jkerny-letter");if(typeof n[t][f]!=w)for(u=n[t][f].replace(/[\n\s]+/g,a).split(a),i=0;i<=u.length;i++)r.applyCss(t+(t.indexOf(p)>-1?l:e)+(t.indexOf(y)>-1?l:" span")+v+i+")",{marginRight:u[i]});if(typeof n[t][o]!=w)for(u=n[t][o].replace(/[\n\s]+/g,a).split(a),i=0;i<=u.length;i++)r.applyCss(t+(t.indexOf(p)>-1?l:e)+v+i+")",{marginRight:u[i]});for(c in r.only_selectors)t.match(r.only_selectors[c])&&(h+=r.rawCss(t,n[t]))}$("<style"+(r.medias_screen!==!1?' media="'+r.medias_screen+'"':l)+' rel="jkerny">'+h+"</style>").appendTo("body")}},filterSelectors:function(n){var u=this,r,t,i,o;if(typeof n==w)return[];r=n;if(u.only_selectors&&u.only_selectors.length||u.only_properties&&u.only_properties.length){var e=u.only_selectors,f=u.only_properties,s={},h=[];for(t=0;t<e.length;t++)for(i in r)(typeof e[t]=="string"?i==e[t]:i.match(e[t]))&&(s[i]=r[i],h.push(r[i].selector));for(t=0;t<f.length;t++)for(i in r)for(o in r[i])if(typeof f[t]=="string"?o.selector==f[t]:o.match(f[t])&&jQuery.inArray(i,h)<0){s[i]=r[i];continue}r=s}return r}},$(function(){$.jkerny.run()})})(jQuery)