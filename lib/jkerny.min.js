/*global jQuery */
/*!
 * jKerny.js
 * Version: 1.33
 * Copyright 2011 Olivier Gorzalka
 * CSS Parser adapted from the jQuery based CSS parser by Daniel Wachsstock Copyright (c) 2011
 * MIT license
 */
(function(d){function r(a){var a=k[a].replace(/^{|}$/g,""),a=p(a),b={};d.each(a.split(";"),function(a,e){e=e.split(":");2>e.length||(b[i(e[0])]=i(e.slice(1).join(":")))});return b}function p(a,b){for(var a=a.replace(s,"$1").replace(t,function(a,b){if(!b)return"";var c="%s`"+ ++l+"`s%";k[l]=b.replace(/^\\/,"");return c}),c=b?u:v;match=c.exec(a);)replacement="%b`"+ ++l+"`b%",k[l]=match[0],a=a.replace(c,replacement);return a}function i(a){if(void 0===a)return a;for(;match=q.exec(a);)a=a.replace(q,k[match[1]]);
return d.trim(a)}function w(a,b){var c=a.split(/\s+/),e=c.shift();"media"==e?(e=i(c.pop()).slice(1,-1),d.parsecss.mediumApplies(c.join(" "))&&d.parsecss(e,b)):"import"==e&&(e=i(c.shift()),d.parsecss.mediumApplies(c.join(" "))&&(e=e.replace(/^url\(|\)$/gi,"").replace(/^["']|["']$/g,""),d.get(e,function(a){d.parsecss(a,b)})))}function m(a,b,c,e){var b=a.text().split(b),f="";b.length&&(d(b).each(function(a,b){f+='<span class="'+c+(a+1)+'">'+b+"</span>"+e}),a.empty().append(f))}d.parsecss=function(a,
b){var c={},a=p(a).replace(/@(([^;`]|`[^b]|`b[^%])*(`b%)?);?/g,function(a,c){w(d.trim(c),b);return""});d.each(a.split("`b%"),function(a,b){b=b.split("%b`");2>b.length||(b[0]=i(b[0]),c[b[0]]=d.extend(c[b[0]]||{},r(b[1])))});b(c)};d.parsecss.mediumApplies=window.media&&window.media.query||function(a){if(!a)return!0;if(a in n)return n[a];d('<style media="'+a+'">body {position: relative; z-index: 1;}</style>').appendTo("head");return n[a]=1==d("body").css("z-index")};var n={},k={},v=/{[^{}]*}/,u=/\[[^\[\]]*\]|{[^{}]*}|\([^()]*\)|function(\s+\w+)?(\s*%b`\d+`b%){2}/,
s=/\/\*@((?:[^\*]|\*[^\/])*)\*\//g,t=/(?:\/\*(?:[^\*]|\*[^\/])*\*\/)|(\\.|"(?:[^\\\"]|\\.|\\\n)*"|'(?:[^\\\']|\\.|\\\n)*')/g,q=/%\w`(\d+)`\w%/,l=0,o={init:function(){return this.each(function(){m(d(this),"","char","")})},words:function(){return this.each(function(){m(d(this)," ","word"," ")})},lines:function(){return this.each(function(){m(d(this).children("br").replaceWith("eefec303079ad17405c889e092e105b0").end(),"eefec303079ad17405c889e092e105b0","line","")})}};d.fn.lettering=function(a){if(a&&
o[a])return o[a].apply(this,[].slice.call(arguments,1));if("letters"===a||!a)return o.init.apply(this,[].slice.call(arguments,0));d.error("Method "+a+" does not exist on jQuery.lettering");return this};d.style=function(a,b){options=d.extend({type:"text/css",media:"all",styleClass:"default"},b);var c=document,e=c.createElement("style"),f="",h;for(h in a)if(a[h].hasOwnProperty){var f=f+(h+" {"),g;for(g in a[h])f+=g+":"+a[h][g]+"; ";f+="} "}c.createStyleSheet?c.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd",
'&nbsp;<style class="'+options.styleClass+'" media="'+options.media+'" type="text/css">'+f+"</style>"):(e=c.createElement("style"),e.type="text/css",e.media=options.media,e.className=options.styleClass,e.appendChild(c.createTextNode(f)),c.getElementsByTagName("head")[0].appendChild(e))};d.jkerny={lettering_replace:{":unknown":"",":((first|last)(-))?(letter|word)":"._$2$3$4","._(letter|word):(first|last)-child":"._$2-$1","._((last|first)-)letter":"span.jkerny-word:$2-child span.jkerny-letter:$2-child",
"._((last|first)-)word":"span.jkerny-word:$2-child","._(letter|word)":"span.jkerny-$1","(span.jkerny-word([^ ]*)?) *span.jkerny-word:(first|last)-child":"$1"},pseudo_structural:":(eq|empty|(first|last|only|nth(-last)?)-(child|of-type))([^\\)]*\\))?",pseudo_selectors:":(hover|enabled|disabled|focus|checked|target|active|visited|after|before)",split_expr:/(>|~|\+)? span.jkerny-(letter|word)/gi,medias_screen:"all",kerning_counter:0,output:{},run:function(){var a=this;d.style({"span.jkerny-word, span.jkerny-letter":{display:"inline-block"},
".jkerny":{visibility:"inherit"}},{styleClass:"jkerny"});d("style:not(.jkerny),link[rel=stylesheet]").each(function(){a.medias_screen="undefined"==typeof d(this).attr("media")?"all":d(this).attr("media");a.output[a.medias_screen]={};this.href&&!this.disabled&&!(0>this.href.indexOf("//"+window.location.host)&&/^\w+:/.test(this.href))?d.ajax({url:this.href,success:function(b){a.parseCss(b)}}):a.parseCss(d(this).removeAttr("type").html())})},parseMediaQueries:function(a){if(a=a.match(RegExp(/@media([^\{]+)\{([^\{\}]+\{[^\}\{]+\})+/),
"gi"))for(var b=0;b<a.length;b++)this.medias_screen=d.trim(a[1]),"undefined"==typeof this.output[this.medias_screen]&&(this.output[this.medias_screen]={}),this.parseCss(a[2],!0)},parseCss:function(a,b){var c=this,e=b||!1,a=c.convertPseudoSelectors(a);d.parsecss(a,function(a){selectors=c.filterSelectors(a);c.proceedCss(selectors)});!1===e&&c.parseMediaQueries(a)},convertPseudoSelectors:function(a){for(var b in this.lettering_replace)a=a.replace(RegExp(b,"gi")," "+this.lettering_replace[b]);return a},
getLength:function(a){var b=0,c;for(c in a)b++;return b},applyProperties:function(a,b){var c,e,f,h,g;h=b.split(",");for(g=0;g<h.length;g++)h[g].replace(RegExp(this.pseudo_selectors),"").split(this.split_expr),c=d(h[g].replace(RegExp(this.pseudo_selectors),"")),f=c.is(".jkerny-letter")?"letter":"word",e=h[g].replace(RegExp("span.jkerny-(letter|word)("+this.pseudo_structural+")?","gi"),".jkerny-$1-"+this.kerning_counter),c.addClass("jkerny-"+f+"-"+this.kerning_counter).parent(".jkerny-word").addClass("jkerny-word-"+
this.kerning_counter),this.output[this.medias_screen][e]=a[b],this.kerning_counter++},proceedCss:function(a){var b,c,e;if(0<this.getLength(a))for(var f in a){b=f.split(",");for(e=0;e<b.length;e++)c=d(b[e].replace(RegExp(this.pseudo_selectors),"").split(this.split_expr)[0]),c.not(".jkerny").addClass("jkerny").lettering("words").children("span").addClass("jkerny-word").lettering().children("span").addClass("jkerny-letter");this.applyProperties(a,f)}0<this.getLength(this.output[this.medias_screen])&&
(d.style(this.output[this.medias_screen],{media:this.medias_screen,styleClass:"jkerny"}),this.output[this.medias_screen]={})},filterSelectors:function(a){var b={},c=[],e,d,h,g,i,j;for(j in a){-1<j.indexOf("jkerny-")&&(b[j]=a[j]);for(var k in a[j])if(e=k.match(RegExp(/-jkerny-(letter|word)-spacing/),"gi")){c=a[j][e[0]].replace(/[\n\s]+/g," ").split(" ");d=j.split(",");for(g=0;g<d.length;g++)for(i=0;i<c.length;i++)h=d[g].replace(RegExp(this.pseudo_selectors),"").split(this.split_expr)[0],b[h+" span.jkerny-"+
e[1]+":eq("+i+")"]={"margin-right":c[i]}}}return b}};d(function(){d.jkerny.run()})})(jQuery);